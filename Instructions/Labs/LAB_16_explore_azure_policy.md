<a name="---"></a><!---
---
Lab: Title: '探索 Azure Policy' Learning Path/Module/Unit: '学习路径：描述 Microsoft 合规性功能；模块 6：描述 Azure 中的资源治理功能；第 2 单元：描述 Azure Policy'
---
--->

# <a name="lab-explore-azure-policy"></a>实验室：了解 Azure Policy

此实验室与下列 Learn 内容保持一致：

- 学习路径：描述 Microsoft 合规性功能
- 模块：描述 Azure 中的资源治理功能
- 单元：描述 Azure Policy

## <a name="lab-scenario"></a>实验室场景

Azure Policy 可帮助实施组织标准并大规模评估合规性。 Azure Policy 通过将 Azure 中资源的属性与业务规则进行比较，来评估这些资源。 在本实验室中，你将创建一个策略并查看该策略的影响。  你还将通过策略页上提供的合规性和修正信息进行探索。

预计用时：15-20 分钟

### <a name="task-1"></a>任务 1

在此任务中，你将创建一个基本策略分配以要求资源组上带有标记。
1.  打开 Microsoft Edge。 在地址栏中，输入“portal.azure.com”。

1. 使用 Azure 订阅的管理员凭据登录（这些管理员凭据不同于 Microsoft 365 管理员凭据）。
    1. 在“登录”窗口中，输入 User1-XXXXXXXX@LODSPRODMSLEARNMCA.onmicrosoft.com（其中 XXXXXXXX 是实验室托管提供商提供的唯一租户 ID），然后选择“下一步” 。

    1. 输入管理员密码，该密码由实验室托管提供商提供。 选择“登录”。
    1. 如果系统提示保持登录状态，请选择“是”。

1. 现已进入 Azure 门户中。  在页面顶部显示 Microsoft Azure 旁边蓝色栏的搜索框中，输入“策略”，然后在搜索结果中选择“策略” 。 这将打开提供仪表板视图的策略主页。  仪表板视图的范围是授权实验室托管商 (ALH) 提供的 Azure 订阅。 你将看到列出了一个策略，这是由 ALH 创建的用于 Azure 订阅的策略。

1. 在左侧导航面板的“创作”下，选择“分配”。

1. 在页面顶部选择“分配策略”。 这会打开分配策略向导，在分配策略的过程中向管理员提供指导。

1. 从“基本信息”选项卡开始。
    1. 对于“范围”，保留默认设置。 在本例中，策略的范围是授权实验室主机托管服务提供商 (ALH) 提供的 Azure 订阅。
    1. 在“策略定义”处选择省略号。  此时会显示可用策略定义列表。  在搜索栏中输入“需要标记”。 在搜索结果中，选择“要求资源组上带有标记”（可能需要向下滚动才能看到），然后按“添加”。   备注：此策略的效果是拒绝创建任何不满足要求的新资源组。  
    1. 记下默认分配名称。  保持名称不变。
    1. 确保“策略实施”设置为“已启用”

1. 选择“下一步”，然后再次选择“下一步”转到“参数”选项卡（也可以直接选择“参数”选项卡）。 

1. 现已进入“参数”选项卡。在“标记名称”字段中，输入“环境”然后选择“下一步” 。

1. 在“修正”选项卡中，保留默认设置，然后选择“下一步”。

1. 现已进入不合规消息选项卡。在不合规消息字段中，输入“需要环境标记”，然后选择“下一步” 。 备注：对于在策略分配之前创建且没有环境标记的资源组，将显示此消息作为不合规的原因。

1. 查看策略分配，然后选择“创建”。  如果未立即看到该策略，请选择“刷新”。 注意：策略可能需要长达 30 分钟才能生效，但通常会快得多。

1. 选择屏幕右上角的“X”，退出“策略分配”页面。

1. 现已进入 Azure 服务主页。  请将此页面保持在打开状态，在下一个任务中将用到它。

### <a name="task-2"></a>任务 2

在此任务中，通过尝试在 Azure 中创建一个没有标记的资源组，可看到 Azure 策略分配的影响。

1. 打开浏览器选项卡“主页 - Microsoft Azure”。

1. 在页面顶部显示 Azure 服务的位置下方，选择“资源组”。

1. 在页面左上角选择“+ 创建”。

1. 在“创建资源组”的“基本信息”选项卡中，保持“订阅”字段不变。

1. 在“资源组”字段中输入“SC900-Labs”。

1. 将“区域”设置保留默认值，然后选择“下一步:标记”。

1. 将标记的“名称”和“值”字段保留为空白。  请勿填充，然后选择“查看 + 创建”。

1. 你将看到验证通过消息（标记名称和值不是向导中的必填字段），然后选择“创建”。

1. 屏幕顶部将显示一条失败消息，指示“资源组创建失败。 选择“查看错误详细信息”。 不满足该 Azure 策略包含的条件，因此资源组创建因不合规而遭到阻止。 注意：如果没有看到失败消息，且资源组已创建，则原因是该策略尚未生效。  请转到“策略”页面，查看在上一任务中创建的策略；策略生效后，将看到该资源不合规。  详细信息页面将包含“不合规”消息。

1. 错误摘要显示错误类型“策略禁止使用资源 SC900-Labs”。  选择屏幕左上角的“X”关闭此窗口。

1. 在“创建资源组”窗口中，选择“上一步”。

1. 这会回到创建资源组的“标记”页面。  在“名称”字段输入“环境”，在“值”字段输入“SC900-Labs”，然后选择“下一步: 审阅 + 创建 >”。

1. 验证标记，然后选择“创建”。

1. 在“名称”字段中输入“环境”，在“值”字段中输入“实验室”（此值可以是任何值，策略只需要标记值），然后选择“下一步: 查看 + 创建>”，然后选择“创建”   。

1. 你将看到资源组被列出。  

1. 从页面顶部的痕迹导航中选择“主页”以返回到 Azure 主页。

1. 使浏览器选项卡保持打开状态，下一个任务会用到它。

### <a name="task-3-optional"></a>任务 3（可选）

在此任务中，你将逐步完成修正不合规资源组的步骤。 注意：用于实验室的 Azure 订阅在更新已修正的资源组的合规性状态时会遇到比正常情况更长的延迟。

1. 在 Azure 主页中，选择“策略”。 这将打开提供仪表板视图的策略主页。  仪表板视图的范围是授权实验室托管商提供的 Azure 订阅。  

1. 应会看到之前创建的策略，请将其选中。

1. 在页面顶部的“概要”下，可以看到名称、描述和其他基本信息。  请注意，该策略显示为“不合规”。  选择策略，详细了解策略不合规的原因。 此处，可以看到列为 resourgegroup1 的资源不合规。  这是创建策略之前创建的资源组的示例。 有关更多信息，请选择“详细信息”。  此处可以看到需要环境标记的合规性消息。  选择右上角的 X 关闭窗口。

1. 选择“resourcegroup1”，然后从页面顶部选择“查看资源” 。
    1. 在显示“标记”的位置旁，选择“编辑”
    1. 将鼠标光标放在“标记”字段中，然后选择“环境”。
    1. 将鼠标光标放在“值”字段中，选择“实验室”，然后选择“保存” 。

1. 现在返回到策略页。  将鼠标光标放在页面顶部的蓝色搜索框中，然后选择“策略”。

1. 从左侧导航面板中，选择“合规性”。  与“概述”页面一样，你可以在此处查看所列策略和/或计划的合规状态。  注意：尽管已将标记添加到资源组，但更新状态需要一段时间。  用于实验室用途的 Azure 订阅可能会遇到比正常情况更长的延迟。 如果想要等待此资源的合规性状态更新，请不要结束实验室。 更新可能需要一小时或更长时间，具体取决于实验室环境。  

### <a name="review"></a>审阅

在本实验室中，你演练了创建 Azure 策略分配的过程，并能够看到该策略的影响。
