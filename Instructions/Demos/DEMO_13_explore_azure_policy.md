---
demo:
    title: '演示：Azure Policy'    
    module: '模块 6：描述 Azure 中的资源治理功能'
---

# <a name="demo-azure-policy"></a>演示：Azure Policy

此演示与下列 Learn 内容保持一致：

- 学习路径：描述 Microsoft 合规性功能
- 模块：描述 Azure 中的资源治理功能
- 单元：描述 Azure Policy

## <a name="demo-scenario"></a>演示方案

在本演示中，你将演练设置 Azure 策略的过程以及该策略的影响。

### <a name="demo-part-1"></a>演示第 1 部分

创建一个“要求资源组上带有标记”策略（显示根据模板创建策略的步骤）

1. 打开 Microsoft Edge。 在地址栏中，输入“portal.azure.com”。  你应该已经登录；如果未登录，请使用管理员凭据进行登录。

1. 在页面顶部显示 Microsoft Azure 旁边蓝色栏的搜索框中，输入“策略”，然后在搜索结果中选择“策略” 。

1. 现在位于“策略”页面的概述部分。 请注意仪表板中提供的信息。

1. 在左侧导航面板的“创作”下，选择“分配”。  你将看到已经有一个策略分配，请选择“ASC 默认”。  查看说明字段。 注意：说明字段引用了 Azure 安全中心（该服务已更名为 Microsoft Defender for Cloud）。  选择页面右上角的“X”，返回到“策略分配”页面。

1. 在页面顶部选择“分配策略”。 这会打开分配策略向导，在分配策略的过程中向管理员提供指导。

1. 从“基本信息”选项卡开始。
    1. 对于“范围”，保留默认设置。 在本例中，策略的范围是授权实验室主机托管服务提供商 (ALH) 提供的 Azure 订阅。
    1. 在“策略定义”处选择省略号。  此时会显示可用策略定义列表。  在搜索栏中输入“需要标记”。 在搜索结果中，选择“要求资源组上带有标记”（可能需要向下滚动才能看到），然后按“选择” 。  备注：此策略的效果是拒绝创建任何不满足要求的新资源组。  
    1. 记下默认分配名称。  保持名称不变。
    1. 确保“策略实施”设置为“已启用”，然后选择“下一步” 。

1. 现已进入“参数”选项卡。在“标记名称”字段中，输入“环境”然后选择“下一步” 。

1. 在“修正”选项卡中，保留默认设置，然后选择“下一步”。

1. 现已进入不合规消息选项卡。在不合规消息字段中，输入“需要环境标记”，然后选择“下一步” 。 备注：对于在策略分配之前创建且没有环境标记的资源组，将显示此消息作为不合规的原因。  

1. 查看策略分配，然后选择“创建”。  如果未立即看到该策略，请选择“刷新”。 注意：策略可能需要长达 30 分钟才能生效，但通常会快得多。

1. 选择屏幕右上角的“X”，退出“策略分配”页面。

1. 现已进入 Azure 服务主页。  请将此页面保持在打开状态，在下一个任务中将用到它。

### <a name="demo-part-2"></a>演示第 2 部分

在此任务中，通过尝试在 Azure 中创建一个没有标记的资源组，可了解 Azure 策略分配所起的作用。

1. 打开浏览器选项卡“主页 - Microsoft Azure”。

1. 在页面顶部显示 Azure 服务的位置下方，选择“资源组”。

1. 在页面左上角选择“+ 创建”。

1. 在“创建资源组”的“基本信息”选项卡中，保持“订阅”字段不变。

1. 在“资源组”字段中输入“SC900-Labs”。

1. 将“区域”设置保留默认值，然后选择“下一步:标记”。

1. 将标记的“名称”和“值”字段保留为空白。  请勿填充，然后选择“查看 + 创建”。

1. 你将看到一条消息，指示验证已通过（标记名称和值不是向导中的必填字段），然后选择“创建”。

1. 屏幕顶部将显示一条失败消息，指示“资源组创建失败。 请选择‘查看错误详细信息’”。 不满足该 Azure 策略包含的条件，因此资源组创建因不合规而遭到阻止。 注意：如果没有看到失败消息，且资源组已创建，则原因是该策略尚未生效。  请转到“策略”页面，查看在上一任务中创建的策略；策略生效后，将看到该资源不合规。  详细信息页面将包含“不合规”消息。

1. 错误摘要显示错误类型“策略禁止使用资源 SC900-Labs”。  选择屏幕左上角的“X”关闭此窗口。

1. 在“创建资源组”窗口中，选择“上一步”。

1. 这会回到创建资源组的“标记”页面。  在“名称”字段输入“环境”，在“值”字段输入“SC900-Labs”，然后选择“下一步: 审阅 + 创建 >”。

1. 验证标记，然后选择“创建”。

1. 在“名称”字段中输入“环境”，在“值”字段中输入“实验室”（此值可以是任何值，策略只需要标记值），然后选择“下一步: 查看 + 创建>”，然后选择“创建”   。

1. 你将看到该资源组已列出。  

1. 向学员指出，如果在创建策略之前创建了资源组，则该资源组现在将显示为不符合此策略分配，并且需要通过应用环境标记进行修正。  有一个标记为 ResourceGroup1 的预先存在的资源组不符合要求，可以进行修正，但在修正后，实验室环境中等待状态更新的时间会比正常情况下更长。

### <a name="review"></a>审阅

在本演示中，你演练了设置 Azure 策略的过程以及该策略的影响。
